# adobe-mun-kinobi
Experimental bulk importer for Adobe Creative Cloud Packages. *NO SUPPORT PROVIDED*.

- Download packages from the Adobe admin portal
- Remove all extended attributes from downloaded zip files/package files (`xattr -rc [folder]`)
- Make sure the munki repo is mounted locally if it is a network share or other type of remote repo that can be mounted to the macOS file system
- Run `./dist/usr/local/bin/adobe-mun-kinobi --adobe-dir [dir]`
- ...
- Profit

# What happens
The `com.googlecode.munki.munkiimport.plist` file is read to determine the correct `repo_url` and `pkginfo_extension` value. If this does not exist either in the user preference domain or the system preference domain, the process is aborted with an error message.

The directory containing all the packages downloaded from the Adobe Admin Console package build system is walked to find all related `_Install.pkg` and `._Uninstall.pkg` files.

Once these are all found, then the `optionXML.xml` file is parsed, as well as the `Application.json` file for each package (the Adobe Acrobat package is treated slightly differently) to get various attributes about the package, such as the application version, minimum OS version requirement, and a basic description of the product.

In most cases, these package files also contain an icon for the application as a `.png` file. This is a fairly basic quality icon that is then passed on as an argument to `munkiimport` as well as the file being copied to the icons folder in the munki repo folder.

## Adobe Acrobat
The Adobe Acrobat package built in the Adobe Admin Console build system is "special" as it does not have the same package structure as the other packages built through this sytem.

The actual installer is a `.dmg` file contained within the `_Install.pkg`. To find out relevant application information for this package, the `.dmg` file is mounted locally and the installer package in the mounted `.dmg` is checked for relevant application information, including the package receipts that need to get added to the `pkginfo` file generated by `munkiimport`. This `pkginfo` file is modified _after_ the package is imported into the munki repo to include these additional receipts with the right version information.

No icon is provided for the Adobe Acrobat installer.

## App Icons
A rudimentary icon is typically copied from each installer except for the Adobe Acrobat installer. It is recommended that you replace these icons with the "prettier" icons that can be created after the application is installed by converting the relevant `.icns` file.

These can be converted using:
```
sips -Z 256 -s format png [infile.icns] --out [outfile.png]
```

When an app icon is found, the filename for the icon copied into the munki repo icons folder is `packagename-pkgversion.png`.

For example, if the `_Install.pkg` is named `adobe-cc.2022.after-effects-silicon_Install.pkg` and the application version is `22.1.1`, the icon filename will be:
```
adobe-cc.2022.after-effects-silicon-22.1.1.png
```

The default folder path for icons is the munki repo with `icons` appended. For example:
```
/Volumes/munki_repo/icons
```


# Usage:
```
usage: adobe-mun-kinobi [-h] [--adobe-dir [dir]] [--locale [locale]] [--category [category]] [--catalog [catalog]] [--developer [developer]] [--munki-repo [dir]]
                        [--munki-subdir [dir]] [--min-munki-version [min munki version]] [--min-os-ver [min os ver]] [--suffix [suffix]] [--import-sap-code [code] [[code] ...]]
                        [--list-sap-codes] [-n] [-v]

optional arguments:
  -h, --help            show this help message and exit
  --adobe-dir [dir]     directory containing unzipped Adobe installers
  --locale [locale]     override the default locale 'en_GB' for all packages processed
  --category [category]
                        override the default category 'Creativity' for all packages processed
  --catalog [catalog]   override the default catalog 'testing' for all packages processed
  --developer [developer]
                        override the default developer 'Adobe' for all packages processed
  --munki-repo [dir]    override or use a custom munki repo path, defaults to 'file:///Volumes/munki_repo'
  --munki-subdir [dir]  override the default package directory 'apps' for all packages processed
  --min-munki-version [min munki version]
                        override the default minimum version of munki '2.1' for all packages processed
  --min-os-ver [min os ver]
                        override the minimum macOS version for all packages processed
  --suffix [suffix]     override the default display name suffix 'Creative Cloud' for all packages processed
  --import-sap-code [code] [[code] ...]
                        import specific Adobe products by SAP code, use '--list-sap-codes' to view codes
  --list-sap-codes      list Adobe products SAP codes
  -n, --dry-run         performs a dry run (outputs import commands to stdout)
  -v, --version         show program's version number and exit
```
